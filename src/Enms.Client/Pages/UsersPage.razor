@page "/users"

@using Enms.Business.Queries
@using Enms.Business.Models.Composite
@using Enms.Client.Attributes
@using Enms.Client.Base
@using Enms.Client.Shared.Streaming
@using Microsoft.AspNetCore.Authorization
@using Microsoft.Extensions.DependencyInjection
@using MudBlazor

@namespace Enms.Client.Pages

@attribute [Navigation(Title = "Users")]
@attribute [Authorize]

@inherits EnmsOwningComponentBase

<Paging
  T="MaybeRepresentingUserModel"
  PageAsync="@((page) => ScopedServices
    .GetRequiredService<RepresentativeQueries>()
    .MaybeRepresentingUsers(pageNumber: page))">
  <Found Context="maybeRepresentingUser">
    @{
      var href = $"user/{maybeRepresentingUser.User.Id}";
      var editHref = $"user/{maybeRepresentingUser.User.Id}/edit";

      <MudCard>
        <MudCardContent>
          <MudText Typo="Typo.h6">
            @maybeRepresentingUser.User.UserName
          </MudText>
          <MudText>
            @maybeRepresentingUser.User.Email
          </MudText>
        </MudCardContent>
        <MudCardActions>
          <MudNavLink Href="@href">
            Details
          </MudNavLink>
          <MudNavLink Href="@editHref">
            Edit
          </MudNavLink>
        </MudCardActions>
      </MudCard>
    }
  </Found>
</Paging>
