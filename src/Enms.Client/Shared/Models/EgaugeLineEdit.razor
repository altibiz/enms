@using Enms.Business.Models
@using Enms.Business.Queries.Agnostic
@using Enms.Client.Shared.Streaming
@using Microsoft.Extensions.DependencyInjection
@using MudBlazor
@inherits Enms.Client.Base.EnmsOwningComponentBase

<MudTextField
  Label="@Translate("Line id")"
  @bind-Value="Model.LineId"
  For="@(() => Model.LineId)"/>
<MudTextField
  Label="@Translate("Title")"
  @bind-Value="Model.Title"
  For="@(() => Model.Title)"/>
<MudTextField
  Label="@Translate("Connected power")"
  @bind-Value="Model.ConnectionPower_W"
  For="@(() => Model.ConnectionPower_W)"/>
<MudSelect
  Label="@Translate("Meter")"
  AnchorOrigin="Origin.BottomCenter"
  @bind-Value="Model.MeterId"
  For="@(() => Model.MeterId)">
  <Paging PageAsync="@(page => ScopedServices.GetRequiredService<AgnosticQueries>().Read<EgaugeMeterModel>(pageNumber: page))">
    <Summary Context="model">
      <MudSelectItem Value="model.Id">
        <EgaugeMeterSummary Model="model"/>
      </MudSelectItem>
    </Summary>
  </Paging>
</MudSelect>
<MudSelect
  Label="@Translate("Validator")"
  AnchorOrigin="Origin.BottomCenter"
  @bind-Value="Model.MeasurementValidatorId"
  For="@(() => Model.MeasurementValidatorId)">
  <Paging PageAsync="@(page => ScopedServices.GetRequiredService<AgnosticQueries>().Read<EgaugeMeasurementValidatorModel>(pageNumber: page))">
    <Summary Context="model">
      <MudSelectItem Value="model.Id">
        <EgaugeMeasurementValidatorSummary Model="model"/>
      </MudSelectItem>
    </Summary>
  </Paging>
</MudSelect>
<MudSelect
  T="PhaseModel"
  Label="@Translate("Phase")"
  AnchorOrigin="Origin.BottomCenter"
  SelectedValuesChanged="@(e => Model.Phases = e.ToHashSet())"
  MultiSelection="true">
  <MudSelectItem Value="PhaseModel.L1">
    L1
  </MudSelectItem>
  <MudSelectItem Value="PhaseModel.L2">
    L2
  </MudSelectItem>
  <MudSelectItem Value="PhaseModel.L3">
    L3
  </MudSelectItem>
</MudSelect>

@code {

  [Parameter]
  public EgaugeLineModel Model { get; set; } = default!;

}
