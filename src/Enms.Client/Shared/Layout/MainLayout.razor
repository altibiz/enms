@namespace Enms.Client.Shared.Layout

@inherits Enms.Client.Base.EnmsLayoutComponentBase
@using Enms.Business.Models
@using Enms.Business.Models.Composite
@using Enms.Client.Shared.Streaming
@using MudBlazor
@using Theme = Theme

<main>
  <MudThemeProvider Theme="_theme"/>
  <MudPopoverProvider />
  <MudDialogProvider/>
  <MudSnackbarProvider/>

  <MudBreakpointProvider>
    <Loading
      T="MaybeRepresentingUserModel"
      LoadAsync="ReadMaybeRepresentingUser">
      <Found Context="maybeRepresentingUser">
        <CascadingValue Value="maybeRepresentingUser.User">
          <UserLayout>
            <Body>
              @if (maybeRepresentingUser.MaybeRepresentative is { } representative)
              {
                <CascadingValue Value="representative">
                  <RepresentativeLayout>
                    <Body>
                    @Body
                    </Body>
                  </RepresentativeLayout>
                </CascadingValue>
              }
              else
              {
                @Body
              }
            </Body>
          </UserLayout>
        </CascadingValue>
      </Found>
    </Loading>
  </MudBreakpointProvider>
</main>

@code {
  private readonly Theme _theme = new();
}
