@using ApexCharts
@using MudBlazor
@using Microsoft.Extensions.DependencyInjection
@using Enms.Business.Models
@using Enms.Client.Base
@using Enms.Client.Shared.Streaming
@using Enms.Client.Shared.Fields
@namespace Enms.Client.Shared.Charts

@inherits EnmsOwningComponentBase

<EnumPicker
  @bind-Value="Measure"
  Label="x => Translate(x.ToTitle())" />
<EnumPicker
  @bind-Value="Resolution"
  Label="x => Translate(x.ToTitle(Multiplier))" />
<MultiEnumPicker
  @bind-Value="Phases"
  Title="@Translate("Phase")"
  Label="x => Translate(x.ToTitle())"/>
<MudNumericField
  @bind-Value="Multiplier"
  Label="@Translate("Multiplier")"
  Min="1"
  Max="@Resolution.MaxMultiplier()"
  Step="1"/>

<ApexChart XAxisType="XAxisType.Datetime"
           Options="@_options"
           @ref="_chart">
  @foreach (var phase in Phases)
  {
    <ApexPointSeries
      Items="@(_measurements.Items)"
      Name="@(phase.ToTitle())"
      SeriesType="SeriesType.Line"
      XValue='x => DateTimeChart(x.Timestamp)'
      YValue="x => x.ChartValue(Measure, phase)"
      Stroke="@(new SeriesStroke { Color = phase.ToColor() })"/>
  }
</ApexChart>
