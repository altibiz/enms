@namespace Enms.Client.Shared.Charts
@using ApexCharts
@using Enms.Business.Models
@using Enms.Business.Models.Enums
@using Enms.Client.Shared.Fields
@using MudBlazor
@inherits Enms.Client.Base.EnmsOwningComponentBase

<EnumPicker
  @bind-Value="Measure"
  Label="x => Translate(x.ToTitle())"/>
<EnumPicker
  @bind-Value="Resolution"
  Label="x => Translate(x.ToTitle(Multiplier))"/>
<MultiEnumPicker
  @bind-Value="Phases"
  Title="@Translate("Phase")"
  Label="x => Translate(x.ToTitle())"/>
<MudNumericField
  @bind-Value="Multiplier"
  Label="@Translate("Multiplier")"
  Min="1"
  Max="@Resolution.MaxMultiplier()"
  Step="1"/>

<ApexChart XAxisType="XAxisType.Datetime"
           Options="@_options"
           @ref="_chart">
  @foreach (var phase in Phases)
  {
    <ApexPointSeries
      Items="@(_measurements.Items)"
      Name="@(phase.ToTitle())"
      SeriesType="SeriesType.Line"
      XValue='x => DateTimeChart(x.Timestamp)'
      YValue="x => x.ChartValue(Measure, phase)"
      Stroke="@(new SeriesStroke { Color = phase.ToColor(), Width = 4 })"/>
  }
</ApexChart>
